<!DOCTYPE html>
<html lang="en">
  <meta charset="utf-8" />
  <style>
    /* .link {
      stroke: #000;
      stroke-width: 1.5px;
    }

    .node {
      cursor: move;
      fill: #ccc;
      stroke: #000;
      stroke-width: 1.5px;
    }

    .node.fixed {
      fill: #f00;
    } */
    .link {
      /* stroke: #aaa; */
      stroke: #ccc;
    }

    .node {
      pointer-events: all;
      stroke: none;
      stroke-width: 40px;
      font: 10px sans-serif;
    }
  </style>
  <head>
    <!-- Latest compiled CSS v3.4.1 -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <!-- jQuery library v3.5.1-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript v3.4.1 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!-- Latest compiled d3 v3 -->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  </head>
  <body>
    <div>
      <select id="selectNumber">
        <option>Choose a number</option>
      </select>
    </div>
    <div>
      <!-- <svg width="2000" height="1200"></svg> -->
      <script>
        let data_filter = undefined;
        function makeNodegraph() {
          var width = 960,
            height = 500;

          var svg = d3
            .select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

          var json = getData(data_filter); //undef for now will need to update

          var force = d3.layout
            .force()
            .gravity(0.05)
            .distance(100)
            .charge(-100)
            .size([width, height])
            .nodes(json.nodes)
            .links(json.links)
            .start();

          var link = svg
            .selectAll(".link")
            .data(json.links)
            .enter()
            .append("line")
            .attr("class", "link");

          var node = svg
            .selectAll(".node")
            .data(json.nodes)
            .enter()
            .append("g")
            .attr("class", "node")
            .call(force.drag);

          let indexer = 0;

          node
            .append("image")
            .attr("xlink:href", function (d) {
              if (indexer == 0) {
                var imagePath = "match_banners/Rayo VallecanoVillarreal CF.png";
                indexer = indexer + 1;
              } else if (indexer == 1) {
                var imagePath = "match_banners/Atletico MadridGranada CF.png";
                indexer = indexer + 1;
              } else {
                var imagePath = "match_banners/FC St. GallenBSC Young Boys.png";
              }
              return imagePath;
            })
            .attr("x", -8)
            .attr("y", -8)
            .attr("width", 16)
            .attr("height", 16);

          node
            .append("text")
            .attr("dx", 12)
            .attr("dy", ".35em")
            .text(function (d) {
              return d.name;
            });

          force.on("tick", function () {
            link
              .attr("x1", function (d) {
                return d.source.x;
              })
              .attr("y1", function (d) {
                return d.source.y;
              })
              .attr("x2", function (d) {
                return d.target.x;
              })
              .attr("y2", function (d) {
                return d.target.y;
              });

            node.attr("transform", function (d) {
              return "translate(" + d.x + "," + d.y + ")";
            });
          });
        }

        let matchesJson;
        let teamCsv;
        let matchesArray = [];

        function getData(league_id) {
          //reading the data

          var PromiseWrapper = (xhr, d) =>
            new Promise((resolve) => xhr(d, (p) => resolve(p)));

          Promise.all([
            PromiseWrapper(d3.json, "data/match.json"),
            PromiseWrapper(d3.csv, "data/team.csv"),
          ]).then((resolve) => {
            matchesJson = resolve[0].results;
            teamCsv = resolve[1];
            matchesJson.forEach(function (data) {
              let home_t;
              let away_t;
              teamCsv.forEach(function (team_data) {
                let temp_arr = []; // might need to change this need later
                if (team_data.team_api_id == data.home_team_api_id) {
                  home_t = team_data.team_long_name;
                } else if (team_data.team_api_id == data.away_team_api_id) {
                  away_t = team_data.team_long_name;
                }
              });
              matchesArray.push([home_t, away_t, home_t + away_t]);
              //call next function here
              //throw new Error();
              //the above was to force an error and only have to do this one at a time
            });
          });

          console.log(matchesArray);

          return {
            nodes: [
              {
                name: "Match1",
              },
              {
                name: "Match2",
              },
              {
                name: "Match3",
              },
            ],
            links: [
              {
                source: 1,
                target: 0,
              },
              {
                source: 2,
                target: 0,
              },
            ],
          };
        }
        var select = document.getElementById("selectNumber");
        var options = ["1", "2", "3", "4", "5"];
        for (var i = 0; i < options.length; i++) {
          var opt = options[i];
          var el = document.createElement("option");
          el.textContent = opt;
          el.value = opt;
          select.appendChild(el);
        }
        makeNodegraph();
      </script>
    </div>
  </body>
</html>
