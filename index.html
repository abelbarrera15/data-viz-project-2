<!DOCTYPE html>
<html lang="en">
  <meta charset="utf-8" />
  <style>
    .link {
      stroke: #000;
      stroke-width: 1.5px;
    }

    .node {
      cursor: move;
      fill: #ccc;
      stroke: #000;
      stroke-width: 1.5px;
    }

    .node.fixed {
      fill: #f00;
    }
  </style>
  <head>
    <!-- Latest compiled CSS v3.4.1 -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <!-- jQuery library v3.5.1-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript v3.4.1 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!-- Latest compiled d3 v3 -->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  </head>
  <body>
    <div id="viz">
      <script>
        // var width = 960,
        //   height = 800;

        var width = window.screen.width,
          height = window.screen.height;

        var radius = 40;

        var color = d3.scale.category20();

        var force = d3.layout
          .force()
          .size([width, height])
          .charge(-400)
          .linkDistance(100)
          .on("tick", tick);

        var drag = force.drag().on("dragstart", dragstart);

        var svg = d3
          .select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", height);

        var link = svg.selectAll(".link"),
          node = svg.selectAll(".node");

        d3.json("sample_code/data/test_data_smaller.json", function (graph) {
          force.nodes(graph.nodes).links(graph.links).start();

          var defs = svg.append("svg:defs");

          defs
            //.selectAll(".pattern")
            //.data(graph.nodes)
            //.enter()
            //.append("pattern")
            .append("svg:pattern")
            //.attr("id", function(d) { return d.name; })
            // .attr("width", radius * 2)
            // .attr("height", radius * 2)
            .attr("id", "myImage")
            .attr("width", 90)
            .attr("height", 60)
            .attr("class", "pattern")
            .append("image")
            .attr("xlink:href", function (d) {
              //console.log("match_banners/AC BellinzonaBSC Young Boys.png");
              return "match_banners/Rayo VallecanoVillarreal CF.png";
            });
          // .attr("width", radius * 2)
          // .attr("height", radius * 2)
          // .attr("x", 0)
          // .attr("y", 0);

          var link = svg
            .selectAll(".link")
            .data(graph.links)
            .enter()
            .append("line")
            .attr("class", "link");

          // link = link
          //   .data(graph.links)
          //   .enter()
          //   .append("line")
          //   .attr("class", "link");

          var node = svg
            .selectAll(".node")
            .data(graph.nodes)
            .enter()
            .append("rect")
            .attr("class", "node")
            .attr("width", 90)
            .attr("height", 60)
            .attr("fill", "url(#myImage)")
            // .style("fill", function (d) {
            //   return "blue";
            // })
            .on("dblclick", dblclick)
            .call(drag);

          // node = node
          //   .data(graph.nodes)
          //   .enter()
          //   .append("rect")
          //   .attr("class", "node")
          //   .attr("width", 90)
          //   .attr("height", 60)
          //   .on("dblclick", dblclick)
          //   .call(drag);

          // node
          //   .append("g")
          //   .data(graph.nodes)
          //   .enter()
          //   .append("svg:image")
          //   .attr("x", "0")
          //   .attr("y", "0")
          //   .attr("height", "50px")
          //   .attr("width", "60px")
          //   .attr("xlink:href", function (d) {
          //     console.log("im here");
          //     return d.img;
          //   });
        });

        function tick() {
          link
            .attr("x1", function (d) {
              return d.source.x + 25;
            })
            .attr("y1", function (d) {
              return d.source.y + 25;
            })
            .attr("x2", function (d) {
              return d.target.x + 25;
            })
            .attr("y2", function (d) {
              return d.target.y + 25;
            });

          node
            .attr("x", function (d) {
              return d.x;
            })
            .attr("y", function (d) {
              return d.y;
            });
        }

        function dblclick(d) {
          d3.select(this).classed("fixed", (d.fixed = false));
        }

        function dragstart(d) {
          d3.select(this).classed("fixed", (d.fixed = true));
        }
      </script>
    </div>
  </body>
</html>
